name: pipeline
on:
 push: 
  branches:
    - main

permissions:
  issues: write
  contents: write
  packages: write
  repository-projects: write

jobs:
  Build:
    runs-on: macos-latest
    steps:
      - run: npm install -g firebase-tools
      - uses: actions/checkout@v3
      - name: Install nodejs
        uses: actions/setup-node@v3
        with:
          node-version: latest
      - uses: actions/setup-java@v2
        with:
          distribution: 'zulu'
          java-version: '11'
          
      - id: flutter-action
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.7.7'
          channel: 'stable'
          architecture: x64
#       - id: 'auth'
#         name: 'Authenticate to Google Cloud'
#         uses: 'google-github-actions/auth@v1'
#         with:
#           credentials_json: '{
#   "type": "service_account",
#   "project_id": "test-flutter-app-ea100",
#   "private_key_id": "18c29e7ad948cf5f6abadae8158d5f27d88b9a3f",
#   "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC/AkTDKUWS1hio\ncItsl4YM4BODAYW7/HUvP6SL1MktRpxS0kjWWnOVoWjmqtlYSCZUZaVPqnP+YnIp\nuGXEAlQAU9px5Vji+qug6MxOLd8fGjKQPBVd9E9fazssz5DZXHzX19EaQjt1i7FY\nK6hZEnM7XdmTbtv6F2EsF0RI7JMLTfn+0Q3OXtwJwRDFz1qnltUvokIf7kuwIA34\nRiqX5kOs7wPmda4BfF0u+SJihQ34KW+rOZ8dJe9JaDV12WpbPudcTtNocxnxLDPK\nW+dxvvBqrmHDLM1Qjw10/W3oVwfd+01gVDIn1ras/Wa7Oju9MZLwiUsiu5veq0j/\noUY9FOUnAgMBAAECggEAXieuoKtsDc02u3U67S0mGZutUpNCCqAQXdmX8YvTHVvk\nvBjHac6NknFN5gLK/68VId43JnWmFvwNPY6Vr5DcOosbL7C3569cQgXvjAwlo83E\npf/QIo/HPoh704N/6f2i1r0eaLzEVZWmNonSwxGKtvV0xq3LhtTWhCb19KKVe2i7\nF6zQxelDg/KaJZlyXxkzlHAZIJX1O8LrPRMfGpUB7hHw1JL7/WApODbprl/hEzWU\nQ5rVbxjVq/bXuX2uzBPSybQiD7qNvduCeuqW1vJYsv3W6DUCTfc2QWeZghQ3r5am\nUGprBk31PQZGRn3JgHkYBlWjHbEki1Xm3CHeLcqblQKBgQDkVcboA3vl+wLWNLW8\nGYH7N78G5IcG8YxelXTDeDZIREs9RPLnpJa0e3jpyjx708fXP/piMTqXVWv/4SuS\nR4UcDRfUEchivX9PodcLdh/3kllFTequ3WkBgS796g2QByxE9J570tkl0tZVQKuM\nBwZ3xhZEG4wFFfNH9TTFK7PnvQKBgQDWJsCRBua82Z0FY4zY9wr132+GBEDTMt2Q\nVJ5gZPcUR1i8sZMwi9kAyAIN7YqCf64tLmYujymmjF/OEf/YzNFXqk5K+0M3SanW\ncyJTcTBoDHdolj11lw/HC5esScrWwy5xW7+TFjGzJBUsN6PE5zgmTNLokntjMVkq\n+uTvmXEMswKBgQCG8BIuRvDPhrm0cU39LW3dUqJ3plINzm3P768jXUVnC8UTHk4W\nivPtERLxxuxbmVp+YHbN1J31lSvP+ffP6KhHXY15bFDp2WcFXnVBdruJiVlsVZGd\naYeGthtZPxpoxXRqA84tCvv9GE5F74Pxqq0t10iNU2I6FzDAk65t31fgWQKBgDPt\nE5ZW2Q4DqipLWDSnulWiBvW1BE7xr322tuxirvKQ1jhyymDkGAszdCQSbBp2gTJd\nZNN3TT8gHH7oKGRWTZB3MCLISCUYzIC+TB11fapNE4sdmutvZJj7+5wADJoEm7dK\n6unsYMKyRhwBpckx05Cd4ioYkqibp6ZfTbG3QA03AoGBAM44tTbP1z/kqeHPoCK1\neY2Wkos6F3fzY6vLn2jDXb3mIL0Gi+o0ASJm+TCwKQIK/8aGMj8xD7cq0VwtmyWs\nOh5uJr8sMr+A++n4mkKcHDUbF0kCImv6oZqsj/GmGV+WtzUBlHkiuFLVpCUOsfPV\nfCxniWPShBTKcRMhJGIz3qw7\n-----END PRIVATE KEY-----\n",
#   "client_email": "firebase-adminsdk-5h11g@test-flutter-app-ea100.iam.gserviceaccount.com",
#   "client_id": "115817296011922823954",
#   "auth_uri": "https://accounts.google.com/o/oauth2/auth",
#   "token_uri": "https://oauth2.googleapis.com/token",
#   "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
#   "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-5h11g%40test-flutter-app-ea100.iam.gserviceaccount.com",
#   "universe_domain": "googleapis.com"
# }'
      - run: |
          cd hello_world 
          flutter pub get
          flutter build appbundle
        #  firebase appdistribution:distribute build/app/outputs/bundle/release/app-release.aab --debug --app "1:935264185763:android:c9373e09110f60cca7be16"
      - name: Generate the token
        id: generate_token
        uses: getsentry/action-github-app-token@v2
        with:
          app_id: "367437"
          private_key: "MIIEowIBAAKCAQEAxAM2stSgCpL5Swr6+4BGa3/3ZenF7nZKBnezq9eSNBItb4MX
xRLxP5gcSNi+yhkZ5NR+OoSyxWkZr3FQFG2a7x9+kOrPVDNp1kJA1rqhZAo0/cSA
DtEUI1iNnHRdBp9OdZnfcdn0Q8r/44nO7Ju0wks1PQLvKSd2CLKwnGlxGgaQLZmh
BL6/LsJZbRizVokX95nCT3seE9RYvR8ipXGIJkne65dMvIjtCKXbcrQy2FonvV4n
uI3zPqs42EA0gzWeppVmvETldVOw/h5YOk3bfvfIXmyf9YThrUg2KVGkL3syYUBC
H/IUzgeUOllX1QzOrnx8+ing2nfsyv4piqc4KQIDAQABAoIBABGXoD8oqjyIuGst
zxznhGp9j7zL4IHoh/hQogWYUXzu7LkHcQi1DIYCpvc6zNTir9pD4BhsdIcXScDf
UKqks7UmhHuJN5Z9DtC2HY+oLHgIGn10N3Ic/cu2VO9n2jmP7sDLUKytPSkgfRr0
8Wd3CiAuE9cn/kMZUZSyRPuk0wvcxmDgMui1lh2JfSs8RdG2M3n8TDg69RuGyMWu
DVUBGn+gHPRNwYtBtjMhFW8uvMleaABfm+yyhaktJK4wLiOzK+e9aBOaDrmm6B+q
laZ78Gj0OZhTVlmdI0bKGQpWKg6UrNvzsyXlHiJ45jR2cbOp7GHavOLi1pz57Oa1
zXUEUAECgYEA/4JE99oUuYq0ih+zSxPNreFXAo797Eqh0jyEUQn3YEqe/fvASjxo
d5mnDDUGMDC6Mp9ojAy+xCmTXL5/oxcZENDVaafDV9dnE4jNmD1sfzRpJRHHPYiI
5jA6D4LjHIeAWU80EzCbQK+se0SkO2tV52S6KatwiuuzvVlBQoAzqykCgYEAxGOq
2E4+fDwNWATTIBnR6EtePxN6nKgJsC1EQHT79jXoIh2YQb0A+NXTspdqdvFM21FV
QgBPj14W0ksoDPHXzjVxTsWM2taxm7FCPj5xd+7IrFQBGcniQ+nNT0gFtdhCE0bF
zYyIAgJejMH5bzAxop5+DLru4+lYmk7joV51xQECgYEA21wy6/s9+cFcmIz4uAcr
eRHSSq8Kz3ePkFhGXPDKgc/uyiz9/H36TlwLL47CXlMnOFjlP/+dM/phuqkOGa21
5lr0Lf5K1jpnEz1LDV4GrPsJHjsyK+Dxb3aOEk0TwKWQipxWH/eGArYPxdC7kwvm
t38h2K6IM6yCJpjfT0GTmmkCgYA3B6aLzgD8Vud2ToPKbvG+ob/a9N5an0t3rnd9
iEpCB4DwblKHuSpYj7IuTPdsNNlQa030nJmulrLWYnDqj6nlAlypsflyKM7Dzbu+
LUkmTia1AyT70PIyDYWWPZw8BEkflak/m61QwtEzp/b5DQwbgUXY01i1TGGje4+V
XB6sAQKBgFtVQ3WdMJ7jsyHknf83iQtLxW6CM9ptRWKqdn+R1MyxGwcHBegw8ptu
KELZKAlv+LGyLsIr2IAjt9QfuQTbZc74FiZd0nljiR8DtnhCUFpS3F1u0OK07h4k
UZGwxBfvSYVJqlRyhBrg6Vxzpyswz0Z4nmO3Szf4Ys8xnQmpapyy"
  
      - name: Install semantic
        run: |
          npm i semantic-release
      - name: Run semantic
        id: semantic
        run: |
          npx semantic-release --branches main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Do something when a new release published
        if: steps.semantic.outputs.new_release_published == 'true'
        run: |
          echo ${{ steps.semantic.outputs.new_release_version }}
          echo ${{ steps.semantic.outputs.new_release_major_version }}
          echo ${{ steps.semantic.outputs.new_release_minor_version }}
          echo ${{ steps.semantic.outputs.new_release_patch_version }}


        
